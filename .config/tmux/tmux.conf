# === Terminal & Appearance ===
set-option -g default-terminal "tmux-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"
set -g mouse on
set-option -g status-position top
set-option -g pane-border-status off

# === Prefix & Navigation ===
unbind C-b
set -g prefix C-space
bind C-Space send-prefix

# Vim style pane selection
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Shift Alt vim keys to switch windows
bind -n M-H previous-window
bind -n M-L next-window

# === Plugins ===
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'catppuccin/tmux#v2.1.3'

run-shell ~/.config/tmux/plugins/tpm/tpm

# Non-rounded block style
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator ""
set -g @catppuccin_window_middle_separator ""
set -g @catppuccin_window_current_left_separator ""
set -g @catppuccin_window_current_right_separator ""

# === Theme Mode ===
set-environment -g TMUX_THEME_MODE 'dark'  # 'light' atau 'dark'
set -g status-left-length 1000
set -g status-right-length 1000

# === Theme Toggle Function ===
bind -n M-t run-shell '
    current=$(tmux show-environment TMUX_THEME_MODE | cut -d= -f2 2>/dev/null || echo light);
    if [ "$current" = "light" ]; then
        tmux set-environment -g TMUX_THEME_MODE dark;
    else
        tmux set-environment -g TMUX_THEME_MODE light;
    fi
    tmux source-file ~/.tmux.conf;
    tmux display-message "Theme toggled to $TMUX_THEME_MODE"
'

# === Theme Selection ===
if-shell '[ "$TMUX_THEME_MODE" = "dark" ]' {
  # === Dark Mode ===
  set -g window-status-format "#[bg=default,fg=#cad3f5] #I:#W "
  set -g window-status-current-format "#[fg=#ed8796,bg=default]#[bg=#ed8796,fg=#24273a,bold] #I:#W #[fg=#ed8796,bg=default]"

  set -g status-style bg=default,fg=#a6accd
  set -g status-left "#[bg=#89b4fa,fg=#1e1e2e,bold] #H #[bg=#24272a,fg=#89b4fa,nobold] #S #[bg=default,fg=default]  "
  set -g status-right "#[bg=default,fg=#cad3f5] #(basename #{pane_current_path}) #[fg=#89b4fa,bg=#24273a] %H:%M #[bg=#89b4fa,fg=#1e1e2e,bold] %d %b %Y "
} {
  # === Light Mode ===
  set -g window-status-format "#[bg=default,fg=#4c4f69] #I:#W "
  set -g window-status-current-format "#[fg=#ed8796,bg=default]#[bg=#ed8796,fg=#eff1f5,bold] #I:#W #[fg=#ed8796,bg=default]"

  set -g status-style bg=default,fg=#4c4f69
  set -g status-left "#[bg=#1e67f4,fg=#ccd0da,bold] #H #[bg=#ccd0da,fg=#1e67f4,nobold] #S #[bg=default,fg=default]  "
  set -g status-right "#[bg=default,fg=#4c4f69] #(basename #{pane_current_path}) #[fg=#1e67f4,bg=#ccd0da] %H:%M #[bg=#1e67f4,fg=#ccd0da,bold] %d %b %Y "
}

# === Continuum & Resurrect ===
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @ressurect-strategy-vim 'session'

# === Copy Mode ===
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# === Split Panes Shortcuts ===
bind | split-window -h
bind _ split-window -v
unbind '"'
unbind %
